<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®šåˆ¶ä½ çš„ä¸“å±æ­Œå…</title>
    <style>
        /* å®Œæ•´CSSæ ·å¼ä¿æŒä¸å˜ */
#admin-page { display:none; width:100%; }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-buttons {
            display: flex;
            gap: 15px;
        }
        
        .nav-btn {
            padding: 10px 20px;
            background: #ff4081;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .nav-btn:hover, .nav-btn.active {
            background: #f50057;
            transform: translateY(-2px);
        }
        
        .page-container {
            display: flex;
            gap: 20px;
            height: calc(100vh - 120px);
        }
        
        #karaoke-page {
            display: flex;
            width: 100%;
            gap: 20px;
        }
        
        .browse-section {
            flex: 7;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .playlist-section {
            flex: 3;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .search-box input {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 30px;
            font-size: 1rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .search-box button {
            padding: 10px 20px;
            background: #ff4081;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .search-box button:hover {
            background: #f50057;
            transform: translateY(-2px);
        }
        
        .charts-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding: 5px;
        }
        
        .chart-category {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            white-space: nowrap;
        }
        
        .chart-category:hover, .chart-category.active {
            background: #ff4081;
            transform: translateY(-3px);
        }
        
        .songs-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .song {
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .song:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }
        
        .song-info {
            flex: 1;
        }
        
        .song-title {
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .song-artist {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .song-album {
            font-size: 0.8rem;
            opacity: 0.6;
            margin-top: 3px;
        }
        
        .song-controls {
            display: flex;
            gap: 5px;
        }
        
        .add-btn, .preview-btn {
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .preview-btn {
            background: #2196f3;
        }
        
        .add-btn:hover {
            background: #388e3c;
            transform: scale(1.1);
        }
        
        .preview-btn:hover {
            background: #0b7dda;
            transform: scale(1.1);
        }
        
        .playlist {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-top: 10px;
            display: flex;
            flex-direction: column;
        }
        
        .playlist-items {
            flex: 1;
            overflow-y: auto;
            max-height: 400px;
        }
        
        .playlist-item {
            padding: 12px 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            transition: all 0.3s;
        }
        
        .playlist-item:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        
        .playlist-item.dragging {
            opacity: 0.5;
            transform: scale(0.98);
        }
        
        .song-number {
            width: 25px;
            height: 25px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 0.8rem;
        }
        
        .remove-btn {
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8rem;
        }
        
        .remove-btn:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }
        
        .playlist-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .playlist-controls button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .clear-btn {
            background: #f44336;
            color: white;
        }
        
        .share-btn {
            background: #2196f3;
            color: white;
        }
        
        .playlist-controls button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .playlist-pagination {
            display: flex;
            justify-content: center;
            margin-top: 15px;
            gap: 10px;
        }
        
        .playlist-pagination button {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .playlist-pagination button:hover, .playlist-pagination button.active {
            background: #ff4081;
        }
        
        .empty-playlist {
            text-align: center;
            padding: 30px;
            opacity: 0.7;
        }
        
        .loading {
            text-align: center;
            padding: 30px;
            opacity: 0.7;
        }
        
        .error {
            text-align: center;
            padding: 20px;
            background: rgba(244, 67, 54, 0.3);
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .back-btn {
            background: #9c27b0;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            margin-bottom: 15px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            background: #7b1fa2;
            transform: translateY(-2px);
        }
        
        #pricing-page {
            display: none;
            width: 100%;
            overflow-y: auto;
            padding: 20px;
        }
        
        .pricing-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
        }
        
        .pricing-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .pricing-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .pricing-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .pricing-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 200px;
        }
        
        .pricing-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .pricing-card.popular {
            border: 2px solid #ff4081;
            position: relative;
            transform: scale(1.05);
        }
        
        .popular-badge {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff4081;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .plan-name {
            font-size: 1.5rem;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .song-range {
            font-size: 1.1rem;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        
        .price {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #ffeb3b;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }
        
        .price small {
            font-size: 1rem;
            color: #fff;
            opacity: 0.8;
        }
        
        .select-btn {
            width: 100%;
            padding: 12px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
            transition: all 0.3s;
            margin-top: auto;
        }
        
        .select-btn:hover {
            background: #388e3c;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .shipping-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .shipping-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .shipping-details {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .shipping-option {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            flex: 1;
            min-width: 200px;
        }
        
        .region {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .shipping-cost {
            font-size: 1.5rem;
            color: #ffeb3b;
            font-weight: bold;
        }
        
        .delivery-time {
            margin-top: 10px;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .note {
            text-align: center;
            margin-top: 20px;
            font-style: italic;
            opacity: 0.8;
        }
        
        .contact-info {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
        }
        
        .contact-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        
        .contact-details {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }
        
        #order-page {
            display: none;
            width: 100%;
            overflow-y: auto;
            padding: 20px;
        }
        
        .order-form {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .playlist-preview {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .playlist-preview-item {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .price-summary {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .total-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffeb3b;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            padding-top: 10px;
            margin-top: 10px;
        }
        
        .form-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .cancel-btn, .submit-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        .cancel-btn {
            background: #f44336;
            color: white;
        }
        
        .submit-btn {
            background: #4caf50;
            color: white;
        }
        
        .cancel-btn:hover, .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .audio-player {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .audio-player.hidden {
            display: none;
        }
        
        .audio-info {
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .audio-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .audio-controls button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .user-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-info {
            display: none;
            align-items: center;
            gap: 10px;
        }
        
        .login-btn, .logout-btn {
            padding: 8px 15px;
            background: #9c27b0;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .login-btn:hover, .logout-btn:hover {
            background: #7b1fa2;
            transform: translateY(-2px);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 30px;
            border-radius: 15px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .modal h2 {
            margin-bottom: 20px;
            text-align: center;
            color: #1a2a6c;
        }
        
        .modal input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .modal button {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: #1a2a6c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .modal button:hover {
            background: #0d1a4a;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .admin-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .admin-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .admin-controls button {
            padding: 8px 15px;
            background: #ff9800;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .orders-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .orders-table th, .orders-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .orders-table th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: bold;
        }
        
        .status-pending { color: #ff9800; }
        .status-confirmed { color: #4caf50; }
        .status-completed { color: #2196f3; }
        
        @media (max-width: 1200px) {
            .songs-container {
                grid-template-columns: 1fr;
            }
            
            .pricing-cards {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .page-container {
                flex-direction: column;
                height: auto;
            }
            
            #karaoke-page {
                flex-direction: column;
            }
            
            .pricing-card.popular {
                transform: scale(1);
            }
            
            .shipping-details {
                flex-direction: column;
            }
            
            .navbar {
                flex-direction: column;
                gap: 15px;
            }
            
            .form-buttons {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <button class="close-btn" id="close-login">&times;</button>
            <h2>ç™»å½•/æ³¨å†Œ</h2>
            <p>ä½¿ç”¨é©¬æ¥è¥¿äºšç”µè¯å·ç ç™»å½•</p>
            <input type="tel" id="phone-input" placeholder="+60 12-345 6789" pattern="\+60[0-9]{8,10}">
            <button id="login-submit">ç™»å½•/æ³¨å†Œ</button>
            <p style="font-size: 0.8rem; margin-top: 10px; color: #666;">
                æç¤ºï¼šé©¬æ¥è¥¿äºšç”µè¯å·ç æ ¼å¼ä¸º +60 åæ¥8-10ä½æ•°å­—
            </p>
        </div>
    </div>

    <div class="container">
        <!-- å¯¼èˆªæ  -->
        <nav class="navbar">
            <div class="logo">ğŸ¤ å®šåˆ¶ä½ çš„ä¸“å±æ­Œå…</div>
            <div class="nav-buttons">
                <button class="nav-btn active" id="karaoke-nav">ç‚¹æ­Œç³»ç»Ÿ</button>
                <button class="nav-btn" id="pricing-nav">ä»·æ ¼é…å¥—</button>
                <button class="nav-btn" id="admin-nav" style="display: none;">è®¢å•ç®¡ç†</button>
            </div>
            <div class="user-section">
                <div class="user-info" id="user-info">
                    <span id="user-phone"></span>
                    <button class="logout-btn" id="logout-btn">é€€å‡º</button>
                </div>
                <button class="login-btn" id="login-btn">ç™»å½•/æ³¨å†Œ</button>
            </div>
        </nav>
        
        <!-- é¡µé¢å®¹å™¨ -->
        <div class="page-container">
            <!-- ç‚¹æ­Œç³»ç»Ÿé¡µé¢ -->
            <div id="karaoke-page">
                <section class="browse-section">
                    <h2 class="section-title">ğŸµ æ­Œæ›²æµè§ˆ</h2>
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="æœç´¢æ­Œæ‰‹æˆ–æ­Œæ›²...">
                        <button id="search-btn">æœç´¢</button>
                    </div>
                    <div class="charts-container" id="charts-container">
                        <div class="chart-category active" data-category="chinese-pop">ä¸­æ–‡æµè¡Œ</div>
                        <div class="chart-category" data-category="western-pop">æ¬§ç¾æµè¡Œ</div>
                        <div class="chart-category" data-category="chinese-dj">ä¸­æ–‡DJ Remix</div>
                        <div class="chart-category" data-category="chinese-artists">ä¸­æ–‡æ­Œæ‰‹</div>
                        <div class="chart-category" data-category="western-artists">æ¬§ç¾æ­Œæ‰‹</div>
                    </div>
                    <div class="songs-container" id="songs-container">
                        <div class="empty-playlist">è¯·é€‰æ‹©æ’è¡Œæ¦œæˆ–æœç´¢æ­Œæ›²</div>
                    </div>
                </section>
                
                <section class="playlist-section">
                    <h2 class="section-title">ğŸ“‹ æˆ‘çš„æ­Œå• <span id="playlist-count">(0)</span></h2>
                    <div class="playlist" id="playlist">
                        <div class="playlist-items" id="playlist-items">
                            <div class="empty-playlist">æ­Œå•ä¸ºç©ºï¼Œè¯·ä»å·¦ä¾§æ·»åŠ æ­Œæ›²</div>
                        </div>
                        <div class="playlist-pagination" id="playlist-pagination"></div>
                    </div>
                    <div class="playlist-controls">
                        <button class="clear-btn" id="clear-btn">æ¸…ç©ºæ­Œå•</button>
                        <button class="share-btn" id="share-btn">æäº¤è®¢å•</button>
                    </div>
                </section>
            </div>
            
            <!-- ä»·æ ¼é…å¥—é¡µé¢ -->
            <div id="pricing-page">
                <div class="pricing-header">
                    <h1 class="pricing-title">ğŸµ ä»·æ ¼é…å¥—</h1>
                    <p class="pricing-subtitle">é€‰æ‹©é€‚åˆæ‚¨çš„æ­Œå•é…å¥—ï¼Œæ‰“é€ ä¸“å±éŸ³ä¹ä½“éªŒ</p>
                </div>
                
                <section class="pricing-section">
                    <h2 class="section-title">é€‰æ‹©æ‚¨çš„é…å¥—</h2>
                    <div class="pricing-cards">
                        <!-- åŸºç¡€ç‰ˆ -->
                        <div class="pricing-card">
                            <div class="plan-name">åŸºç¡€ç‰ˆ</div>
                            <div class="song-range">1 - 20 é¦–æ­Œæ›²</div>
                            <div class="price">RM<span>29</span></div>
                            <button class="select-btn" data-plan="åŸºç¡€ç‰ˆ" data-min="1" data-max="20" data-price="29">é€‰æ‹©æ­¤é…å¥—</button>
                        </div>
                        
                        <!-- æ ‡å‡†ç‰ˆ -->
                        <div class="pricing-card">
                            <div class="plan-name">æ ‡å‡†ç‰ˆ</div>
                            <div class="song-range">21 - 50 é¦–æ­Œæ›²</div>
                            <div class="price">RM<span>49</span></div>
                            <button class="select-btn" data-plan="æ ‡å‡†ç‰ˆ" data-min="21" data-max="50" data-price="49">é€‰æ‹©æ­¤é…å¥—</button>
                        </div>
                        
                        <!-- è¿›é˜¶ç‰ˆ -->
                        <div class="pricing-card popular">
                            <div class="popular-badge">æœ€å—æ¬¢è¿</div>
                            <div class="plan-name">è¿›é˜¶ç‰ˆ</div>
                            <div class="song-range">51 - 100 é¦–æ­Œæ›²</div>
                            <div class="price">RM<span>69</span></div>
                            <button class="select-btn" data-plan="è¿›é˜¶ç‰ˆ" data-min="51" data-max="100" data-price="69">é€‰æ‹©æ­¤é…å¥—</button>
                        </div>
                        
                        <!-- è±ªåç‰ˆ -->
                        <div class="pricing-card">
                            <div class="plan-name">è±ªåç‰ˆ</div>
                            <div class="song-range">101 - 200 é¦–æ­Œæ›²</div>
                            <div class="price">RM<span>89</span></div>
                            <button class="select-btn" data-plan="è±ªåç‰ˆ" data-min="101" data-max="200" data-price="89">é€‰æ‹©æ­¤é…å¥—</button>
                        </div>
                        
                        <!-- ä¸“ä¸šç‰ˆ -->
                        <div class="pricing-card">
                            <div class="plan-name">ä¸“ä¸šç‰ˆ</div>
                            <div class="song-range">201 - 300 é¦–æ­Œæ›²</div>
                            <div class="price">RM<span>109</span></div>
                            <button class="select-btn" data-plan="ä¸“ä¸šç‰ˆ" data-min="201" data-max="300" data-price="109">é€‰æ‹©æ­¤é…å¥—</button>
                        </div>
                        
                        <!-- æ——èˆ°ç‰ˆ -->
                        <div class="pricing-card">
                            <div class="plan-name">æ——èˆ°ç‰ˆ</div>
                            <div class="song-range">301 - 400 é¦–æ­Œæ›²</div>
                            <div class="price">RM<span>129</span></div>
                            <button class="select-btn" data-plan="æ——èˆ°ç‰ˆ" data-min="301" data-max="400" data-price="129">é€‰æ‹©æ­¤é…å¥—</button>
                        </div>
                        
                        <!-- è‡³å°Šç‰ˆ -->
                        <div class="pricing-card">
                            <div class="plan-name">è‡³å°Šç‰ˆ</div>
                            <div class="song-range">401 - 500 é¦–æ­Œæ›²</div>
                            <div class="price">RM<span>159</span></div>
                            <button class="select-btn" data-plan="è‡³å°Šç‰ˆ" data-min="401" data-max="500" data-price="159">é€‰æ‹©æ­¤é…å¥—</button>
                        </div>
                        
                        <!-- è‡ªå®šä¹‰ç‰ˆ -->
                        <div class="pricing-card">
                            <div class="plan-name">è‡ªå®šä¹‰ç‰ˆ</div>
                            <div class="song-range">501+ é¦–æ­Œæ›²</div>
                            <div class="price">RM<span>0.30</span><small>/æ¯é¦–</small></div>
                            <button class="select-btn" data-plan="è‡ªå®šä¹‰ç‰ˆ" data-min="501" data-max="9999" data-price="0.30">è”ç³»å®šåˆ¶</button>
                        </div>
                    </div>
                </section>
                
                <section class="shipping-info">
                    <h2 class="shipping-title">é…é€ä¿¡æ¯</h2>
                    <div class="shipping-details">
                        <div class="shipping-option">
                            <div class="region">è¥¿é©¬</div>
                            <div class="shipping-cost">å…è´¹é…é€</div>
                            <div class="delivery-time">é¢„è®¡ 5-7 ä¸ªå·¥ä½œæ—¥å†…é€è¾¾</div>
                        </div>
                        <div class="shipping-option">
                            <div class="region">ä¸œé©¬</div>
                            <div class="shipping-cost">RM 8.00</div>
                            <div class="delivery-time">é¢„è®¡ 7-10 ä¸ªå·¥ä½œæ—¥å†…é€è¾¾</div>
                        </div>
                    </div>
                    <p class="note">* æ‰€æœ‰é…å¥—å‡åŒ…å«å®Œæ•´çš„æŠ€æœ¯æ”¯æŒå’Œå”®åæœåŠ¡</p>
                </section>
                
                <section class="contact-info">
                    <h2 class="contact-title">éœ€è¦å¸®åŠ©ï¼Ÿ</h2>
                    <p class="contact-details">è”ç³»æˆ‘ä»¬çš„å®¢æœå›¢é˜Ÿï¼š</p>
                    <p class="contact-details">ğŸ“ ç”µè¯: +60 12-345 6789</p>
                    <p class="contact-details">âœ‰ï¸ é‚®ç®±: support@karaoke.com</p>
                    <p class="contact-details">ğŸ•’ æœåŠ¡æ—¶é—´: å‘¨ä¸€è‡³å‘¨æ—¥ 9:00 - 18:00</p>
                </section>
            </div>
            
            <!-- è®¢å•é¡µé¢ -->
            <div id="order-page">
                <div class="order-form">
                    <h2 class="section-title">å¡«å†™è®¢å•èµ„æ–™</h2>
                    
                    <div class="form-group">
                        <label for="customer-name">å§“å</label>
                        <input type="text" id="customer-name" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="customer-phone">ç”µè¯å·ç </label>
                        <input type="tel" id="customer-phone" placeholder="+60 12-345 6789" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="customer-address">æ”¶è´§åœ°å€</label>
                        <input type="text" id="customer-address" placeholder="è¯·è¾“å…¥è¯¦ç»†æ”¶è´§åœ°å€" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="customer-state">å·å±</label>
                        <select id="customer-state" required>
                            <option value="">è¯·é€‰æ‹©å·å±</option>
                            <option value="west">è¥¿é©¬</option>
                            <option value="east">ä¸œé©¬</option>
                        </select>
                    </div>
                    
                    <div class="playlist-preview" id="order-playlist-preview">
                        <!-- æ­Œå•é¢„è§ˆå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    
                    <div class="price-summary" id="price-summary">
                        <!-- ä»·æ ¼æ‘˜è¦å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    
                    <div class="form-buttons">
                        <button class="cancel-btn" id="cancel-order">å–æ¶ˆ</button>
                        <button class="submit-btn" id="submit-order">ç¡®è®¤è®¢å•</button>
                    </div>
                </div>
            </div>
            
            <!-- è®¢å•ç®¡ç†é¡µé¢ -->
            <div id="admin-page" style="display: none; width: 100%; overflow-y: auto; padding: 20px;">
                <div class="pricing-header">
                    <h1 class="pricing-title">ğŸ“Š è®¢å•ç®¡ç†ç³»ç»Ÿ</h1>
                    <p class="pricing-subtitle">æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰å®¢æˆ·è®¢å•</p>
                </div>
                
                <section class="admin-section">
                    <h2 class="section-title">è®¢å•åˆ—è¡¨</h2>
                    <div class="admin-controls">
                        <button id="refresh-orders">åˆ·æ–°è®¢å•</button>
                        <button id="export-orders">å¯¼å‡ºè®¢å•</button>
                    </div>
                    <div class="orders-container" id="orders-container">
                        <table class="orders-table">
                            <thead>
                                <tr>
                                    <th>è®¢å•ç¼–å·</th>
                                    <th>å®¢æˆ·å§“å</th>
                                    <th>ç”µè¯å·ç </th>
                                    <th>æ­Œæ›²æ•°é‡</th>
                                    <th>é…å¥—</th>
                                    <th>æ€»é‡‘é¢</th>
                                    <th>çŠ¶æ€</th>
                                    <th>ä¸‹å•æ—¶é—´</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="orders-tbody">
                                <!-- è®¢å•æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </div>
    
    <!-- éŸ³é¢‘æ’­æ”¾å™¨ -->
    <div class="audio-player hidden" id="audio-player">
        <div class="audio-info" id="audio-info">è¯•å¬ä¸­...</div>
        <div class="audio-controls">
            <button id="play-pause-btn">â¸ï¸</button>
            <button id="stop-btn">â¹ï¸</button>
        </div>
    </div>

    <!-- å…ˆåŠ è½½Supabaseåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // ==================== åº”ç”¨é…ç½® ====================
        const CONFIG = {
            SUPABASE_URL: 'https://cnatjskljtjqolznoizb.supabase.co',
            SUPABASE_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNuYXRqc2tsanRqcW9sem5vaXpiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzMDUzMzMsImV4cCI6MjA3ODg4MTMzM30.okHQXFBoLaMyR3wdgP-1W_Z1spqcb-ihC4Xf2gz1MgU',
            ADMIN_PHONES: ['+60123456789', '+60198765432'], // ç®¡ç†å‘˜ç”µè¯å·ç 
            SONGS_PER_PAGE: 10
        };

        // ==================== å…¨å±€çŠ¶æ€ ====================
        const AppState = {
            currentUser: null,
            currentSongs: [],
            playlist: [],
            currentAudio: null,
            isPlaying: false,
            isSearchResultsView: false,
            currentPlaylistPage: 1,
            isSupabaseReady: false,
            supabase: null
        };

        // ==================== æ ¸å¿ƒåˆå§‹åŒ– ====================
        async function initializeApp() {
            console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–åº”ç”¨...');
            
            try {
                // 1. åˆå§‹åŒ–Supabase
                await initializeSupabase();
                
                // 2. åˆå§‹åŒ–åŸºæœ¬åŠŸèƒ½
                initializeBasicFeatures();
                
                // 3. æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
                checkUserLogin();
                
                // 4. åŠ è½½é»˜è®¤é¡µé¢
                loadChart('chinese-pop');
                
                console.log('âœ… åº”ç”¨åˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('âŒ åº”ç”¨åˆå§‹åŒ–å¤±è´¥:', error);
                showMessage('åº”ç”¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢');
            }
        }

        // ==================== Supabaseåˆå§‹åŒ– ====================
        async function initializeSupabase() {
            try {
                if (!window.supabase) {
                    throw new Error('Supabaseåº“æœªåŠ è½½');
                }
                
                AppState.supabase = window.supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_KEY);
                
                // æµ‹è¯•è¿æ¥
                const { data, error } = await AppState.supabase.from('users').select('count').limit(1);
                if (error) throw error;
                
                AppState.isSupabaseReady = true;
                console.log('âœ… Supabaseè¿æ¥æˆåŠŸ');
            } catch (error) {
                console.log('âš ï¸ Supabaseè¿æ¥å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡å¼:', error.message);
                AppState.isSupabaseReady = false;
            }
        }

        // ==================== åŸºæœ¬åŠŸèƒ½åˆå§‹åŒ– ====================
        function initializeBasicFeatures() {
            initializePageNavigation();
            initializePricingButtons();
            initializeUserSystem();
            initializeKaraokeSystem();
            initializeOrderSystem();
            initializeAdminSystem();
        }

        // ==================== é¡µé¢å¯¼èˆª ====================
        function initializePageNavigation() {
            document.getElementById('karaoke-nav').addEventListener('click', () => showPage('karaoke'));
            document.getElementById('pricing-nav').addEventListener('click', () => showPage('pricing'));
            document.getElementById('admin-nav').addEventListener('click', () => {
                showPage('admin');
                if (AppState.isSupabaseReady) loadOrders();
            });
        }

        function showPage(page) {
            const pages = ['karaoke', 'pricing', 'order', 'admin'];
            pages.forEach(p => {
                const el = document.getElementById(p + '-page');
                if (el) el.style.display = 'none';
            });
            const current = document.getElementById(page + '-page');
            if (!current) return;
            if (page === 'karaoke') current.style.display = 'flex';
            else current.style.display = 'block';
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            const navBtn = document.getElementById(page + '-nav');
            if (navBtn) navBtn.classList.add('active');
        }
            
            // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(page + '-nav').classList.add('active');
        }

        // ==================== ä»·æ ¼é…å¥— ====================
        function initializePricingButtons() {
            document.querySelectorAll('.select-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const planName = this.dataset.plan;
                    const price = this.dataset.price;
                    alert(`æ‚¨é€‰æ‹©äº† ${planName}\nä»·æ ¼: RM${price}`);
                });
            });
        }

        // ==================== ç”¨æˆ·ç³»ç»Ÿ ====================
        function initializeUserSystem() {
            document.getElementById('login-btn').addEventListener('click', () => {
                document.getElementById('login-modal').style.display = 'flex';
            });
            
            document.getElementById('close-login').addEventListener('click', () => {
                document.getElementById('login-modal').style.display = 'none';
            });
            
            document.getElementById('login-submit').addEventListener('click', handleLogin);
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
        }

        function checkUserLogin() {
            const savedUser = localStorage.getItem('currentUser');
            const savedPhone = localStorage.getItem('userPhone');
            
            if (savedUser && savedPhone) {
                AppState.currentUser = savedUser;
                updateUserUI();
                loadUserPlaylist();
                checkAdminAccess(savedPhone);
            }
        }

        function updateUserUI() {
            const savedPhone = localStorage.getItem('userPhone');
            
            if (savedPhone) {
                document.getElementById('user-phone').textContent = savedPhone;
                document.getElementById('user-info').style.display = 'flex';
                document.getElementById('login-btn').style.display = 'none';
            } else {
                document.getElementById('user-info').style.display = 'none';
                document.getElementById('login-btn').style.display = 'block';
                document.getElementById('admin-nav').style.display = 'none';
            }
        }

        function checkAdminAccess(phone) {
            if (CONFIG.ADMIN_PHONES.includes(phone)) {
                document.getElementById('admin-nav').style.display = 'block';
            } else {
                document.getElementById('admin-nav').style.display = 'none';
            }
        }

        async function handleLogin() {
            const phoneInput = document.getElementById('phone-input');
            const phone = phoneInput.value.trim();
            const malaysiaPhoneRegex = /^\+60[0-9]{8,10}$/;
            
            if (!malaysiaPhoneRegex.test(phone)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é©¬æ¥è¥¿äºšç”µè¯å·ç ï¼ˆæ ¼å¼ï¼š+60xxxxxxxxï¼‰');
                return;
            }
            
            try {
                showMessage('ç™»å½•ä¸­...');
                
                let userId;
                if (AppState.isSupabaseReady) {
                    const { data: user, error } = await AppState.supabase
                        .from('users')
                        .upsert({ 
                            phone: phone,
                            updated_at: new Date().toISOString()
                        }, {
                            onConflict: 'phone',
                            ignoreDuplicates: false
                        })
                        .select()
                        .single();
                    
                    if (error) throw error;
                    userId = user.id;
                } else {
                    userId = 'local_' + Date.now();
                }
                
                AppState.currentUser = userId;
                localStorage.setItem('currentUser', userId);
                localStorage.setItem('userPhone', phone);
                
                updateUserUI();
                checkAdminAccess(phone);
                document.getElementById('login-modal').style.display = 'none';
                
                await loadUserPlaylist();
                showMessage(`æ¬¢è¿å›æ¥ï¼${phone}`);
                
            } catch (error) {
                console.error('ç™»å½•å¤±è´¥:', error);
                // é™çº§åˆ°æœ¬åœ°æ¨¡å¼
                AppState.currentUser = 'local_' + Date.now();
                localStorage.setItem('currentUser', AppState.currentUser);
                localStorage.setItem('userPhone', phone);
                updateUserUI();
                checkAdminAccess(phone);
                document.getElementById('login-modal').style.display = 'none';
                showMessage('ä½¿ç”¨æœ¬åœ°æ¨¡å¼ç™»å½•');
            }
        }

        function handleLogout() {
            AppState.currentUser = null;
            localStorage.removeItem('currentUser');
            localStorage.removeItem('userPhone');
            updateUserUI();
            AppState.playlist = [];
            renderPlaylist();
            updatePlaylistCount();
            showMessage('å·²é€€å‡ºç™»å½•');
        }

        // ==================== ç‚¹æ­Œç³»ç»Ÿ ====================
        function initializeKaraokeSystem() {
            // æ’è¡Œæ¦œç‚¹å‡»
            document.getElementById('charts-container').addEventListener('click', (e) => {
                if (e.target.classList.contains('chart-category')) {
                    loadChart(e.target.dataset.category);
                }
            });
            
            // æ­Œæ›²æ“ä½œ
            document.getElementById('songs-container').addEventListener('click', handleSongClick);
            
            // æ­Œå•æ“ä½œ
            document.getElementById('playlist-items').addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-btn')) {
                    removeSongFromPlaylist(parseInt(e.target.dataset.index));
                }
            });
            
            // æœç´¢åŠŸèƒ½
            document.getElementById('search-btn').addEventListener('click', performSearchHandler);
            document.getElementById('search-input').addEventListener('keyup', (e) => {
                if (e.key === 'Enter') performSearchHandler();
            });
            
            // æ­Œå•æ§åˆ¶
            document.getElementById('clear-btn').addEventListener('click', clearPlaylist);
            document.getElementById('share-btn').addEventListener('click', sharePlaylist);
            
            // éŸ³é¢‘æ§åˆ¶
            document.getElementById('play-pause-btn').addEventListener('click', togglePlayPause);
            document.getElementById('stop-btn').addEventListener('click', stopAudio);
        }

        function handleSongClick(e) {
            if (e.target.classList.contains('add-btn')) {
                const songId = e.target.dataset.id;
                const artist = e.target.dataset.artist;
                if (artist) performSearch(artist);
                else if (songId) addSongToPlaylist(songId);
            } else if (e.target.classList.contains('preview-btn')) {
                const songId = e.target.dataset.id;
                const previewUrl = e.target.dataset.preview;
                previewSong(songId, previewUrl);
            }
        }

        function performSearchHandler() {
            const query = document.getElementById('search-input').value.trim();
            if (query) {
                performSearch(query);
            } else {
                showMessage('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
            }
        }

        // ==================== æ­Œæ›²æœç´¢ï¼ˆæ–¹æ¡ˆCï¼šæ··åˆæ–¹æ¡ˆï¼‰ ====================
        async function searchMusic(term, limit = 50) {
            try {
                showLoading('æ­£åœ¨æœç´¢...');
                
                // å°è¯•ä½¿ç”¨iTunes API
                const response = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(term)}&entity=musicTrack&limit=${limit}&country=CN`);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.resultCount > 0) {
                        const songs = data.results.map(track => ({
                            id: track.trackId || Math.random().toString(36).substr(2, 9),
                            title: track.trackName || 'æœªçŸ¥æ­Œæ›²',
                            artist: track.artistName || 'æœªçŸ¥æ­Œæ‰‹',
                            album: track.collectionName || 'æœªçŸ¥ä¸“è¾‘',
                            duration: track.trackTimeMillis,
                            previewUrl: track.previewUrl,
                            artwork: track.artworkUrl100
                        }));
                        console.log('âœ… iTunes APIæœç´¢æˆåŠŸï¼Œæ‰¾åˆ°', songs.length, 'é¦–æ­Œæ›²');
                        return songs;
                    }
                }
                
                throw new Error('iTunes APIæ— ç»“æœ');
                
            } catch (error) {
                console.log('âš ï¸ iTunes APIå¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:', error.message);
                // é™çº§åˆ°æ¨¡æ‹Ÿæ•°æ®
                return generateMockSongs(term, limit);
            }
        }

        function generateMockSongs(query, limit) {
            const allSongs = [
                { id: 1, title: 'å‘Šç™½æ°”çƒ', artist: 'å‘¨æ°ä¼¦', album: 'å‘¨æ°ä¼¦çš„åºŠè¾¹æ•…äº‹', duration: 215000, previewUrl: 'https://audio-ssl.itunes.apple.com/itunes-assets/Music6/v4/9d/1f/ea/9d1fea2a-8d0f-8c0e-7e4f-8e8b8e8b8e8b/mzaf_881208636621313765.plus.aac.p.m4a' },
                { id: 2, title: 'å…‰å¹´ä¹‹å¤–', artist: 'é‚“ç´«æ£‹', album: 'å…‰å¹´ä¹‹å¤–', duration: 235000, previewUrl: 'https://audio-ssl.itunes.apple.com/itunes-assets/Music6/v4/9d/1f/ea/9d1fea2a-8d0f-8c0e-7e4f-8e8b8e8b8e8b/mzaf_881208636621313765.plus.aac.p.m4a' },
                { id: 3, title: 'æ¼”å‘˜', artist: 'è–›ä¹‹è°¦', album: 'ç»…å£«', duration: 257000, previewUrl: 'https://audio-ssl.itunes.apple.com/itunes-assets/Music6/v4/9d/1f/ea/9d1fea2a-8d0f-8c0e-7e4f-8e8b8e8b8e8b/mzaf_881208636621313765.plus.aac.p.m4a' },
                { id: 4, title: 'å¹´å°‘æœ‰ä¸º', artist: 'æè£æµ©', album: 'è€³æœµ', duration: 244000, previewUrl: 'https://audio-ssl.itunes.apple.com/itunes-assets/Music6/v4/9d/1f/ea/9d1fea2a-8d0f-8c0e-7e4f-8e8b8e8b8e8b/mzaf_881208636621313765.plus.aac.p.m4a' },
                { id: 5, title: 'èµ·é£äº†', artist: 'ä¹°è¾£æ¤’ä¹Ÿç”¨åˆ¸', album: 'èµ·é£äº†', duration: 318000, previewUrl: 'https://audio-ssl.itunes.apple.com/itunes-assets/Music6/v4/9d/1f/ea/9d1fea2a-8d0f-8c0e-7e4f-8e8b8e8b8e8b/mzaf_881208636621313765.plus.aac.p.m4a' }
            ];
            
            // æ ¹æ®æŸ¥è¯¢è¯è¿‡æ»¤
            const filtered = allSongs.filter(song => 
                song.title.toLowerCase().includes(query.toLowerCase()) ||
                song.artist.toLowerCase().includes(query.toLowerCase())
            );
            
            return filtered.slice(0, limit);
        }

        async function loadChart(category) {
            AppState.isSearchResultsView = false;
            let searchTerm = '';
            
            switch(category) {
                case 'chinese-pop': searchTerm = 'å‘¨æ°ä¼¦ é‚“ç´«æ£‹ è–›ä¹‹è°¦'; break;
                case 'western-pop': searchTerm = 'taylor swift ed sheeran'; break;
                case 'chinese-dj': searchTerm = 'ä¸­æ–‡ remix'; break;
                case 'chinese-artists': 
                    renderArtistsList(['å‘¨æ°ä¼¦', 'æ—ä¿Šæ°', 'é‚“ç´«æ£‹', 'è–›ä¹‹è°¦', 'æè£æµ©']);
                    return;
                case 'western-artists':
                    renderArtistsList(['Taylor Swift', 'Ed Sheeran', 'Ariana Grande']);
                    return;
            }
            
            AppState.currentSongs = await searchMusic(searchTerm, 30);
            renderSongs(AppState.currentSongs);
            
            // æ›´æ–°æ´»è·ƒçŠ¶æ€
            document.querySelectorAll('.chart-category').forEach(cat => cat.classList.remove('active'));
            document.querySelector(`[data-category="${category}"]`).classList.add('active');
        }

        function renderArtistsList(artists) {
            const container = document.getElementById('songs-container');
            container.innerHTML = '';
            
            artists.forEach(artist => {
                const element = document.createElement('div');
                element.className = 'song';
                element.innerHTML = `
                    <div class="song-info">
                        <div class="song-title">${artist}</div>
                        <div class="song-artist">æ­Œæ‰‹</div>
                    </div>
                    <div class="song-controls">
                        <button class="add-btn" data-artist="${artist}">æœç´¢</button>
                    </div>
                `;
                container.appendChild(element);
            });
        }

        function renderSongs(songs) {
            const container = document.getElementById('songs-container');
            container.innerHTML = '';
            
            if (songs.length === 0) {
                container.innerHTML = '<div class="empty-playlist">æœªæ‰¾åˆ°ç›¸å…³æ­Œæ›²</div>';
                return;
            }
            
            if (AppState.isSearchResultsView) {
                const backBtn = document.createElement('button');
                backBtn.className = 'back-btn';
                backBtn.textContent = 'â† è¿”å›æ’è¡Œæ¦œ';
                backBtn.onclick = () => {
                    AppState.isSearchResultsView = false;
                    loadChart('chinese-pop');
                };
                container.appendChild(backBtn);
            }
            
            songs.forEach(song => {
                const element = document.createElement('div');
                element.className = 'song';
                element.innerHTML = `
                    <div class="song-info">
                        <div class="song-title">${song.title}</div>
                        <div class="song-artist">${song.artist}</div>
                        <div class="song-album">${song.album}</div>
                    </div>
                    <div class="song-controls">
                        ${song.previewUrl ? `<button class="preview-btn" data-id="${song.id}" data-preview="${song.previewUrl}">â–¶ï¸</button>` : ''}
                        <button class="add-btn" data-id="${song.id}">+</button>
                    </div>
                `;
                container.appendChild(element);
            });
        }

        async function performSearch(query) {
            AppState.isSearchResultsView = true;
            AppState.currentSongs = await searchMusic(query, 50);
            renderSongs(AppState.currentSongs);
        }

        function addSongToPlaylist(songId) {
            const song = AppState.currentSongs.find(s => s.id == songId);
            if (song && !AppState.playlist.some(s => s.id == songId)) {
                AppState.playlist.push({...song});
                AppState.currentPlaylistPage = 1;
                renderPlaylist();
                updatePlaylistCount();
                showMessage(`å·²æ·»åŠ  "${song.title}" åˆ°æ­Œå•`);
                saveUserPlaylist();
            } else if (song) {
                showMessage(`"${song.title}" å·²åœ¨æ­Œå•ä¸­`);
            }
        }

        function removeSongFromPlaylist(index) {
            if (index >= 0 && index < AppState.playlist.length) {
                const songTitle = AppState.playlist[index].title;
                AppState.playlist.splice(index, 1);
                renderPlaylist();
                updatePlaylistCount();
                showMessage(`å·²ä»æ­Œå•ç§»é™¤ "${songTitle}"`);
                saveUserPlaylist();
            }
        }

        function renderPlaylist() {
            const container = document.getElementById('playlist-items');
            const pagination = document.getElementById('playlist-pagination');
            
            container.innerHTML = '';
            
            if (AppState.playlist.length === 0) {
                container.innerHTML = '<div class="empty-playlist">æ­Œå•ä¸ºç©ºï¼Œè¯·ä»å·¦ä¾§æ·»åŠ æ­Œæ›²</div>';
                pagination.innerHTML = '';
                return;
            }
            
            const startIndex = (AppState.currentPlaylistPage - 1) * CONFIG.SONGS_PER_PAGE;
            const endIndex = Math.min(startIndex + CONFIG.SONGS_PER_PAGE, AppState.playlist.length);
            const currentSongs = AppState.playlist.slice(startIndex, endIndex);
            
            currentSongs.forEach((song, index) => {
                const globalIndex = startIndex + index;
                const item = document.createElement('div');
                item.className = 'playlist-item';
                item.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <div class="song-number">${globalIndex + 1}</div>
                        <div class="song-info">
                            <div class="song-title">${song.title}</div>
                            <div class="song-artist">${song.artist}</div>
                        </div>
                    </div>
                    <button class="remove-btn" data-index="${globalIndex}">Ã—</button>
                `;
                container.appendChild(item);
            });
            
            renderPlaylistPagination();
        }

        function renderPlaylistPagination() {
            const pagination = document.getElementById('playlist-pagination');
            pagination.innerHTML = '';
            
            if (AppState.playlist.length <= CONFIG.SONGS_PER_PAGE) return;
            
            const totalPages = Math.ceil(AppState.playlist.length / CONFIG.SONGS_PER_PAGE);
            
            if (AppState.currentPlaylistPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.textContent = 'ä¸Šä¸€é¡µ';
                prevBtn.onclick = () => {
                    AppState.currentPlaylistPage--;
                    renderPlaylist();
                };
                pagination.appendChild(prevBtn);
            }
            
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.textContent = i;
                pageBtn.className = i === AppState.currentPlaylistPage ? 'active' : '';
                pageBtn.onclick = () => {
                    AppState.currentPlaylistPage = i;
                    renderPlaylist();
                };
                pagination.appendChild(pageBtn);
            }
            
            if (AppState.currentPlaylistPage < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.textContent = 'ä¸‹ä¸€é¡µ';
                nextBtn.onclick = () => {
                    AppState.currentPlaylistPage++;
                    renderPlaylist();
                };
                pagination.appendChild(nextBtn);
            }
        }

        function updatePlaylistCount() {
            document.getElementById('playlist-count').textContent = `(${AppState.playlist.length})`;
        }

        function clearPlaylist() {
            if (AppState.playlist.length === 0) {
                showMessage('æ­Œå•å·²ç»æ˜¯ç©ºçš„');
                return;
            }
            
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ­Œå•å—ï¼Ÿ')) {
                AppState.playlist = [];
                AppState.currentPlaylistPage = 1;
                renderPlaylist();
                updatePlaylistCount();
                showMessage('æ­Œå•å·²æ¸…ç©º');
                saveUserPlaylist();
            }
        }

        function sharePlaylist() {
            if (AppState.playlist.length === 0) {
                showMessage('æ­Œå•ä¸ºç©ºï¼Œæ— æ³•æäº¤è®¢å•');
                return;
            }
            
            if (!AppState.currentUser) {
                showMessage('è¯·å…ˆç™»å½•ä»¥ä¿å­˜å’Œæäº¤è®¢å•');
                document.getElementById('login-modal').style.display = 'flex';
                return;
            }
            
            showOrderPage();
        }

        // ==================== éŸ³é¢‘åŠŸèƒ½ ====================
        function previewSong(songId, previewUrl) {
            const song = AppState.currentSongs.find(s => s.id == songId);
            
            if (song && previewUrl) {
                if (AppState.currentAudio) {
                    AppState.currentAudio.pause();
                    AppState.currentAudio = null;
                }
                
                try {
                    AppState.currentAudio = new Audio(previewUrl);
                    const audioPlayer = document.getElementById('audio-player');
                    const audioInfo = document.getElementById('audio-info');
                    const playPauseBtn = document.getElementById('play-pause-btn');
                    
                    AppState.currentAudio.play().then(() => {
                        AppState.isPlaying = true;
                        playPauseBtn.textContent = "â¸ï¸";
                        audioPlayer.classList.remove('hidden');
                        audioInfo.textContent = `è¯•å¬: ${song.title} - ${song.artist}`;
                        showMessage(`å¼€å§‹è¯•å¬ "${song.title}"`);
                    }).catch(() => {
                        showMessage('è¯•å¬æ’­æ”¾å¤±è´¥');
                    });
                    
                    AppState.currentAudio.addEventListener('ended', () => {
                        stopAudio();
                        showMessage(`è¯•å¬ç»“æŸ: ${song.title}`);
                    });
                    
                } catch (error) {
                    showMessage('è¯•å¬åŠŸèƒ½æš‚ä¸å¯ç”¨');
                }
            } else {
                showMessage('è¯¥æ­Œæ›²æš‚æ— è¯•å¬åŠŸèƒ½');
            }
        }

        function togglePlayPause() {
            if (AppState.currentAudio) {
                const playPauseBtn = document.getElementById('play-pause-btn');
                if (AppState.isPlaying) {
                    AppState.currentAudio.pause();
                    playPauseBtn.textContent = "â–¶ï¸";
                } else {
                    AppState.currentAudio.play().then(() => {
                        playPauseBtn.textContent = "â¸ï¸";
                    });
                }
                AppState.isPlaying = !AppState.isPlaying;
            }
        }

        function stopAudio() {
            if (AppState.currentAudio) {
                AppState.currentAudio.pause();
                AppState.currentAudio.currentTime = 0;
                AppState.isPlaying = false;
                document.getElementById('play-pause-btn').textContent = "â–¶ï¸";
                document.getElementById('audio-player').class